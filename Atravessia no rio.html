<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travessia no rio - Perigo no Rio</title>
    <style>
        :root {
            --water: #2980b9;
            --grass: #27ae60;
            --stone-tex: radial-gradient(circle at 30% 30%, #bdc3c7, #7f8c8d);
        }

        body {
            margin: 0; font-family: 'Segoe UI', sans-serif;
            background-color: #222; display: flex;
            flex-direction: column; align-items: center; color: white; overflow: hidden;
        }

        #ui { padding: 10px; text-align: center; width: 95%; max-width: 400px; display: flex; justify-content: space-around; background: #333; }

        #game-container {
            position: relative; width: 95vw; max-width: 400px; height: 80vh; max-height: 600px;
            background-color: var(--water);
            background-image: url('https://www.transparenttextures.com/patterns/water.png');
            border: 12px solid #34495e; border-radius: 10px; cursor: crosshair;
        }

        .bank {
            position: absolute; width: 100%; height: 50px;
            background-color: var(--grass); z-index: 10;
            display: flex; align-items: center; justify-content: center; font-weight: bold;
        }

        #bank-start { top: 0; } #bank-end { bottom: 0; }

        .stone {
            position: absolute; width: 50px; height: 40px;
            background: var(--stone-tex); border-radius: 45% 55% 40% 60%;
            box-shadow: 3px 4px 0px rgba(0,0,0,0.3); z-index: 5;
        }

        .collectible { cursor: pointer; border: 2px solid gold; animation: float 2s infinite ease-in-out; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }

        .alligator {
            position: absolute; width: 80px; height: 30px;
            background: #1b4d3e; border-radius: 50% 80% 80% 50%;
            z-index: 4; display: flex; align-items: center; justify-content: center;
            border: 2px solid #000;
        }
        .alligator::after { content: 'üêä'; font-size: 20px; }
        
        /* √Årea de perigo vis√≠vel apenas para debug (opcional) */
        .danger-zone {
            position: absolute; border: 1px dashed rgba(255,0,0,0.3);
            border-radius: 50%; pointer-events: none; z-index: 3;
        }

        #player {
            position: absolute; width: 35px; height: 35px; border-radius: 50%;
            z-index: 20; top: 7px; left: 182px;
            transition: all 0.5s ease-in-out; border: 3px solid rgba(255,255,255,0.5);
        }

        #overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); display: flex;
            flex-direction: column; align-items: center; justify-content: center; z-index: 100;
            padding: 20px; text-align: center;
        }

        .form-group { margin: 10px 0; display: flex; flex-direction: column; width: 80%; }
        .form-group input { padding: 10px; border-radius: 5px; border: none; margin-top: 5px; }

        .btn { padding: 12px 25px; margin: 5px; cursor: pointer; border: none; border-radius: 5px; font-weight: bold; text-transform: uppercase; }

        .btn-retornar {
            background: #047dbe;
            color: rgb(24, 35, 83);
            box-shadow: 0 5px 15px rgba(9, 66, 253, 0.986);
            border-radius: 40px;
            text-decoration: none;
        }
    </style>
</head>
<body>

    <div id="ui">
        <div>‚ù§Ô∏è Vidas: <span id="lives">3</span></div>
        <div>‚≠ê Pontos: <span id="score">0</span></div>
        <div>Fase: <span id="lvl">1</span></div>
    </div>

    <div style="margin: 10px; color: #f1c40f;">Pedras no Invent√°rio: <span id="inv-count">0</span></div>

    <div id="game-container" onclick="placeStone(event)">
        <div id="bank-start" class="bank">PARTIDA</div>
        <div id="river"></div>
        <div id="player" style="display: none;"></div>
        <div id="bank-end" class="bank">DESTINO</div>

        <div id="overlay">
            <h2 id="msg-title">Atravesse o rio: Travessia</h2>
            
            <div id="char-selection">
                <p>Escolha seu Personagem:</p>
                <button class="btn" onclick="pick('boy')" style="background: #3498db; color: white;">Menino (Azul)</button>
                <button class="btn" onclick="pick('girl')" style="background: #e84393; color: white;">Menina (Rosa)</button>
            </div>

            <div id="game-over-form" style="display: none; width: 100%;">
                <p>O Rio venceu desta vez! Envie seus dados:</p>
                <div class="form-group">
                    <label>Nome:</label>
                    <input type="text" id="user-name" placeholder="Seu nome">
                </div>
                <div class="form-group">
                    <label>Idade:</label>
                    <input type="number" id="user-age" placeholder="Sua idade">
                </div>
                <div class="form-group">
                    <label>WhatsApp:</label>
                    <input type="tel" id="user-whatsapp" placeholder="(00) 00000-0000">
                </div>
                <button class="btn" onclick="sendData()" style="background: #27ae60; color: white;">Enviar para o ZAP</button>
            </div>
        </div>
    </div>

    <div style="margin-top: 15px;">
        <button class="btn" id="btn-play" onclick="tryCross()" style="background: #27ae60; color: white;" disabled>Atravessar Rio</button>
        <button class="btn" onclick="resetBridge()" style="background: #95a5a6;">Limpar Ponte</button>

    </div>
    <div>
    <a href="Novo Estefani.html"_blank" class="btn-retornar">Retornar</a></div>

<script>
    let level = 1; let lives = 3; let score = 0;
    let inInventory = 0; let required = 6;
    let bridgeStones = []; let alligators = [];
    let isMoving = false; let jumpDistance = 130;
    
    // ALCANCE DO JACAR√â AUMENTADO: Se passar a menos de 70px (quase o dobro do anterior), ele pega.
    let alligatorAggroRange = 70; 

    const river = document.getElementById('river');
    const player = document.getElementById('player');
    const btnPlay = document.getElementById('btn-play');

    function pick(type) {
        player.style.backgroundColor = type === 'boy' ? '#3498db' : '#e84393';
        document.getElementById('overlay').style.display = 'none';
        player.style.display = 'block';
        initLevel();
    }

    function initLevel() {
        river.innerHTML = '';
        bridgeStones = []; alligators = [];
        inInventory = 0; isMoving = false;
        required = 5 + level;
        
        player.style.top = "7px"; player.style.left = "182px";
        player.style.opacity = "1"; player.style.transform = "scale(1)";
        
        updateStats();
        btnPlay.disabled = true;

        spawnCollectibles();
        if(level >= 5) spawnAlligators();
    }

    function spawnCollectibles() {
        for(let i=0; i < required; i++) {
            let s = document.createElement('div');
            s.className = 'stone collectible';
            s.style.left = Math.random() * 340 + "px";
            s.style.top = (100 + Math.random() * 350) + "px";
            s.onclick = (e) => {
                e.stopPropagation(); inInventory++; score += 10;
                updateStats(); s.remove();
                if(inInventory > 0) btnPlay.disabled = false;
            };
            river.appendChild(s);
        }
    }

    function spawnAlligators() {
        let num = Math.min(level - 3, 7); 
        for(let i=0; i < num; i++) {
            let a = document.createElement('div');
            a.className = 'alligator';
            let x = Math.random() * 300;
            let y = 150 + (Math.random() * 300);
            a.style.left = x + "px"; a.style.top = y + "px";
            river.appendChild(a);
            
            // Armazena o centro do jacar√© para c√°lculo de colis√£o
            alligators.push({x: x + 40, y: y + 15});
        }
    }

    function placeStone(e) {
        if(inInventory <= 0 || isMoving) return;
        const rect = document.getElementById('game-container').getBoundingClientRect();
        const x = e.clientX - rect.left - 25;
        const y = e.clientY - rect.top - 20;
        if(y < 55 || y > 545) return;

        let s = document.createElement('div');
        s.className = 'stone';
        s.style.left = x + "px"; s.style.top = y + "px";
        river.appendChild(s);

        bridgeStones.push({x: x + 10, y: y});
        bridgeStones.sort((a, b) => a.y - b.y);
        inInventory--;
        updateStats();
    }

    async function tryCross() {
        isMoving = true; btnPlay.disabled = true;
        let cX = 182; let cY = 7;

        for(let stone of bridgeStones) {
            let dist = Math.sqrt(Math.pow(stone.x - cX, 2) + Math.pow(stone.y - cY, 2));
            if(dist <= jumpDistance) {
                await jump(stone.x, stone.y);
                // Checa se o ponto onde o jogador pousou (ou passou do lado) tem um jacar√© perto
                if(checkAlligator(stone.x, stone.y)) return;
                cX = stone.x; cY = stone.y;
            } else {
                await fall("A pedra estava longe demais!"); return;
            }
        }

        let distFinal = Math.sqrt(Math.pow(182 - cX, 2) + Math.pow(560 - cY, 2));
        if(distFinal <= jumpDistance) {
            await jump(182, 560);
            score += 100; alert("Travessia √âpica! +100 pontos!");
            level++; initLevel();
        } else { await fall("Margem de destino inalcan√ß√°vel!"); }
    }

    function checkAlligator(px, py) {
        for(let a of alligators) {
            let d = Math.sqrt(Math.pow(a.x - px, 2) + Math.pow(a.y - py, 2));
            // O bote acontece se estiver dentro do raio de 70px
            if(d < alligatorAggroRange) { 
                fall("ATAQUE DE JACAR√â! Voc√™ passou muito perto do perigo!");
                return true;
            }
        }
        return false;
    }

    function jump(x, y) {
        return new Promise(r => {
            player.style.left = x + "px"; player.style.top = y + "px";
            player.style.transform = "scale(1.3)";
            setTimeout(() => { player.style.transform = "scale(1)"; r(); }, 500);
        });
    }

    async function fall(msg) {
        player.style.transform = "scale(0.1)"; player.style.opacity = "0";
        lives--; updateStats();
        setTimeout(() => {
            alert(msg);
            if(lives <= 0) {
                showGameOver();
            } else { resetBridge(); }
        }, 500);
    }

    function showGameOver() {
        document.getElementById('msg-title').innerText = "JORNADA ENCERRADA";
        document.getElementById('char-selection').style.display = 'none';
        document.getElementById('game-over-form').style.display = 'block';
        document.getElementById('overlay').style.display = 'flex';
    }

    function sendData() {
        const name = document.getElementById('user-name').value;
        const age = document.getElementById('user-age').value;
        const zap = document.getElementById('user-whatsapp').value;

        if(!name || !age) { alert("Informe o seu nome e idade!"); return; }

        const message = `*RELAT√ìRIO DE TRAVESSIA NO RIO*%0A%0A*Nome:* ${name}%0A*Idade:* ${age}%0A*Zap:* ${zap}%0A*Fase Final:* ${level}%0A*Score:* ${score}`;
        const phone = "553898648423";
        window.open(`https://api.whatsapp.com/send?phone=${phone}&text=${message}`, '_blank');
        location.reload();
    }

    function updateStats() {
        document.getElementById('score').innerText = score;
        document.getElementById('lives').innerText = lives;
        document.getElementById('lvl').innerText = level;
        document.getElementById('inv-count').innerText = inInventory;
    }

    function resetBridge() { 
        player.style.opacity = "1"; player.style.transform = "scale(1)";
        initLevel(); 
    }
</script>
</body>
</html>
